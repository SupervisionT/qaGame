The project is generated by [LoopBack 3.x](http://loopback.io).


## Setup
clone the repo and install the dependances by running 
```
npm i
```
make sure that you have mysql 5+ installed on your device in you want to run the project on your machine.

Configure the datasource file
```
./server/datasources.json
```
You may need to change the user and the password into your own credentials. You can set new user and password by issuing this statement:
```
mysql> ALTER USER 'root'@'localhost' IDENTIFIED BY 'your_password_here';
```

## Launch the Application

To run the application you can use one of the following scripts:

```
npm start
```
This script will do the following actions:
- Drop old database
- Create new database
- Run LoopBack Server
- Migrate LoopBack tables
- Migrate Models tables
- Seed dummy data

```
npm run server
```
If you have your database ready then use this script. This script will do the following actions:
- Run LoopBack Server
- Migrate LoopBack tables
- Migrate Models tables
- Seed dummy data

more scripts:
```
npm run db
```
Drop the datebase then creat a new one


## APIs
All APIs run on the first version release, v1.  

#### User
For users managment the application only has **login endpoint**
```
POST /api/v1/Users/login
```
You can use the predefined user credentials to access the application
```
{
    "email": "a@b.com",
    "password": "Abcd1234"
}
```

Example on using login endpoint
**Curl**
```
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{ \ 
 "email": "a%40b.com", \ 
 "password": "Abcd1234" \ 
 }' 'http://localhost:3000/api/v1/Users/login'
 ```
After login completed successfuly you should expected reciveing response body as following:
```
{
  "id": "wEVEx2leOwO09OXWS8lJIjvTtfeR8Z2U7AsUjfEUHMCAaOhhrl1N7GmDeXZvzk7E",
  "ttl": 1209600,
  "created": "2020-10-26T17:41:19.113Z",
  "userId": 1
}
```
The "id" attribute is your access token that need to use when access endpoints that need authentication.

#### Questions

All the read, GET, endpoints does not require authentication.

**1-** To find all instances of the model from the data source you may use:
```
GET /api/v1/Questions
```
###### pagination
- If you didn't include filter or filter limit value set to 0 in your requiest a default pagination setting will added to your request and return only the first DEFAUL_PAGINATION results.
- If filter included and its limit value exceed the maximum DEFAUL_PAGINATION_LIMIT it'll reset the filter limit value into the MAX_PAGINATION_LIMIT.
- To select next page you may use "skip" attribute in filter body.

Example without filter:
```
// Curl
curl -X GET --header 'Accept: application/json' 'http://localhost:3001/api/v1/Questions'
//URL
http://localhost:3001/api/v1/Questions
```
Example with filter and skip:
```
//Curl
curl -X GET --header 'Accept: application/json' 'http://localhost:3001/api/v1/Questions?filter=%7B%22limit%22%3A%204%2C%20%22skip%22%3A%204%20%7D'
//URL
http://localhost:3001/api/v1/Questions?filter=%7B%22limit%22%3A%204%2C%20%22skip%22%3A%204%20%7D
```

**2-**Count instances of the model matched by where from the data source<br/>
This method is useful to calculate the number of questions pages and to set the filter values, limit and spip.
```
GET /api/v1/Questions/count
```

**3-**Counts answers of Questions.<br/>
This method is useful to calculate the number of question answers pages and to set the filter values, limit and spip.
```
GET /api/v1/Questions/{id}/answers/count
```


**4-** You can find a model instance by {{id}} from the data source
```
GET /api/v1/Questions/{id}
```

**5-** You can queries all answers of specific question
```
GET /api/v1/Questions/{id}/answers
```
You need to set the targeted question id in your query path.

The pagination policy will applied to the requiest/response as described in **GET /api/v1/Questions** endpoint

**6-** Create a new instance of the model and persist it into the data source<br/>
Require Authentication
```
POST /api/v1/Questions
```
Example:
```
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{ \ 
   "title": "new question", \ 
   "body": "more data&#33;" \ 
 }' 'http://localhost:3001/api/v1/Questions'
 ```

 **7-** Creates a new instance in answers of this model.<br/>
Require Authentication
This method useful to create multiple Answers recoreds that have relation with the question ID.<br/>
It accept single object or array of objects. Each object contains only the body key and its value. The query will set the votes to its default value, 0, and the questionId foreign Key to the question id.
 ```
 POST /api/v1/Questions/{id}/answers
 ```
 You need to set the targeted question id in your query path.<br/>

 Example:
 ```
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '[ \ 
 { \ 
   "body": "answer 1" \ 
 }, \ 
 { \ 
   "body": "answer 2" \ 
 } \ 
 ]' 'http://localhost:3001/api/v1/Questions/1/answers?access_token=YOUR_ACCESS_TOKEN
 ```

 #### Answers

All the read, GET, endpoints does not require authentication.

**1-** Find all instances of the model matched by filter from the data source.
```
GET /api/v1/Answers
```
The pagination policy will applied to the requiest/response as described in **GET /Questions** endpoint

**2-** Find a model instance by {{id}} from the data source
```
GET /api/v1/Answers/{id}
```

**3-** Count instances of the model matched by where from the data source<br/>
This method is useful to calculate the number of answers pages and to set the filter values, limit and spip.
```
GET /api/v1/Answers/count
```

**4-** Update a votes attribute by id for answers<br/>
Require Authentication<br/>
 This method allow the user to upvote or down vote any answer.<br/>
 You need to set the targeted answer id and the vote value , up or down, in your query path.
```
PUT /api/v1/Answers/{id}/vote/{vote}
```
Example:
```
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' 'http://localhost:3001/api/v1/Answers/8/vote/up?access_token=YOUR_ACCESS_TOKEN
```
This will upvote answer 8. You should expect the following response:
```
{
  "voting": {
    "body": "UK",
    "votes": 1,
    "questionId": 2,
    "id": 8
  }
}
```

**5-** Create a new instance of the model and persist it into the data source
Require Authentication<br/>

```
POST /api/v1/Answers
```
This method is similer to method 7 in questions APIs. The difference that you need to set the questionId foreign Key by your self.
It's not recommended to use this method to add answers to questions.


For more details and to test the APIs you may visit the [LoopBack API Explorer](http://localhost:3001/explorer/)

